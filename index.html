<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IBBL PAR FILE</title>

</head>

<style>
    body {
        font-family: Arial, sans-serif;
        margin: 20px;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
    }

    th,
    td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: left;
    }

    th {
        background-color: #f2f2f2;
    }

    button {
        padding: 5px 10px;
        margin: 5px;
        cursor: pointer;
    }

    #dataDisplay {
        margin-top: 20px;
    }

    p {
        font-size: 16px;
        margin: 5px 0;
    }
</style>

<body>
    <input type="file" id="fileInput" />
    <table id="dataTable">
        <!-- Data from Excel will be inserted here -->
    </table>

    <div id="dataDisplay">
        <!-- Data from Excel will be inserted here -->
<div id="selectedValue">
<p>HDT:TID=<span id="value1"></span>:MID=<span id="value2"></span>:1:1:1:0101:050:050:TK:115:90:100:6001010000</p>
<p>TCT:ADDR1(36)=<span id="add-1"></span>:ADDR2(36)=<span id="add-2"></span>:ADDR3(36)=<span id="add-3"></span>:ADDR4(36)=<span id="add-4"></span>:ADDR5(36)=<span id="add-5"></span>:MERCHANTNAME1(24)=<span id="dba-1"></span>:MERCHANTNAME2(28)=<span id="dba-2"></span>:4225:0000:0000:0000:0000:42256925</p>
<p>SUPPORTBIN:ENGINEERNAME=ANAYET:ENGINEERMOBILE=01806971103:OFFICERNAME=<span id="officer"></span>:OFFICERMOBILE=<span id="officernumber"></span>:EMAIL=test.ibbl@ibbl.com</p>
<p>SIMBIN:BANGLALINK=<span id="bl"></span>:GRAMEENPHONE=<span id="gp"></span>:ROBI=<span id="robi"></span>:OTHERS=0</P>
<p>IPBIN:IP1=192.168.225.138,IP2=192.168.225.138:IP1=192.168.225.138,IP2=192.168.225.138:IP1=10.210.1.194,IP2=10.210.1.194:IP1=172.31.1.43,IP2=172.31.1.43:PORT1=10002,PORT2=10002:PORT1=10002,PORT2=10002:PORT1=10002,PORT2=10002:PORT1=10002,PORT2=10002</p>
<p>TXN:SALE=1:VOID=1:QRSALE=0:CASH=0:EMI=0:CARDEMI=0:PREAUTH=0:TIPADJUSTOFF=0:TIPADJUSTON=0:TIPWITHSALE=0:SETTLEMENT=1:BALANCEINQ=0:REFUND=0:SHOWTXN=0:LOGON=1:MACEXCHANGE=1:KEYEXCHANGE=1:SALECOMPOFF=0:SALECOMPON=0:OFFLINE=0:REPORT=1</p>
<p>MRT:SALE:VOID:CASH ADV:EMI SALE:BATCHREPORT+:REPRINT:SETTLEMENT:LOGON:MACEXCHANGE:KEYEXCHANGE:PREAUTH:SHOWTXN:TIPADJUST:BALANCEINQ:CANCELLATION:ADMIN:SETTING</p>
<p>PMTTYP:CHIP=1:NFC=1:CASHNFC=1:MAG=1:SALEMANUAL=0:EMIMANUAL=0:CASHMANUAL=0:PREAUTHMANUAL=0:FALLBACK=0:LAST4DIGIT=0:CVV2INPUT=0</p>
<p>LIMIT:999:999:100:99999999:50000:5000000:50000:3,6,9,12</p>
<p>CARDEMICHARGEBIN:3,3:6,4:9,6.5:12,8:18,10.5:24,13:36,18</p>
<p>SLIPPRINT:CUSTOMERCOPY=1:LOGON=1:CARDDETAILSREPORT=0:SETTLEDETAILSREPORT=0:ERRORTXN=1</p>
<p>EXPMASKING:EXPMASKMC=1:EXPMASKCC=1:EXPMASKDT=1:EXPMASKPREAUTH=1:EXPMASKDISP=1:EXPMASKSHOWTXN=1:EXPMASKEMI=1:EXPMASKERRRP=1</p>
<p>PANMASKING:PANMASKMC=1:PANMASKCC=0:PANMASKDT=1:PANMASKPREAUTH=1:PANMASKDISP=1:PANMASKSHOWTXN=0:PANMASKEMI=1:PANMASKERRRP=1</p>
<p>EMIBIN:5483210000000000,5483219999999999,16:4391310000000000,4391319999999999,16:4391320000000000,4391329999999999,16:4391330000000000,4391339999999999,16:4391340000000000,4391349999999999,16:4365260000000000,4365269999999999,16:5213920000000000,5213929999999999,16:5300030000000000,5300039999999999,16:4084090000000000,4084099999999999,16:4000000000000000,4999999999999999,16</p>
<p>CASHBIN:5483210000000000,5483219999999999,16:4391310000000000,4391319999999999,16:4391320000000000,4391329999999999,16:4391330000000000,4391339999999999,16:4391340000000000,4391349999999999,16:4365260000000000,4365269999999999,16:5213920000000000,5213929999999999,16:5300030000000000,5300039999999999,16:4084090000000000,4084099999999999,16:4375940000000000,4375949999999999,16</p>
<p>BINWISELIMIT:5000:5000000:5483210000000000,5483219999999999,16:4391310000000000,4391319999999999,16</p>
<p>CDT0:433435000000:433435999999:12,13,14,15,16,17,18,19:VISA:11111111111</p>
<p>CDT1:439132000000:439132999999:12,13,14,15,16,17,18,19:VISA:11111111111</p>
<p>CDT2:439133000000:439133999999:12,13,14,15,16,17,18,19:VISA:11111111111</p>
<p>CDT3:439134000000:439134999999:12,13,14,15,16,17,18,19:VISA:11111111111</p>
<p>CDT4:436526000000:436526999999:12,13,14,15,16,17,18,19:VISA:11111111111</p>
<p>CDT5:462870000000:462870999999:12,13,14,15,16,17,18,19:VISA:11111111111</p>
<p>CDT6:400000000000:499999999999:12,13,14,15,16,17,18,19:VISA:11111111111</p>
<p>CDT7:548321000000:548321999999:12,13,14,15,16,17,18,19:MASTERCARD:11111111111</p>
<p>CDT8:530003000000:530003999999:12,13,14,15,16,17,18,19:MASTERCARD:11111111111</p>
<p>CDT9:521392000000:521392999999:12,13,14,15,16,17,18,19:MASTERCARD:11111111111</p>
<p>CDT10:526238000000:526238999999:12,13,14,15,16,17,18,19:MASTERCARD:11111111111</p>
<p>CDT11:500000000000:599999999999:12,13,14,15,16,17,18,19:MASTERCARD:11111111111</p>
<p>CDT12:222100000000:272099999999:12,13,14,15,16,17,18,19:MASTERCARD:11111111111</p>
<p>CDT13:100000000000:199999999999:12,13,14,15,16,17,18,19:NPSB:11111111111</p>
<p>CDT14:600000000000:699999999999:12,13,14,15,16,17,18,19:UPI:11111111111</p>
<p>CDT15:800000000000:899999999999:12,13,14,15,16,17,18,19:UPI:11111111111</p>
<p>CDT16:639996000000:639996809999:12,13,14,15,16,17,18,19:TAKAPAY:11111111111</p>
<p>CDT17:639996040000:639996069999:12,13,14,15,16,17,18,19:IBBL TAKAPAY:11111111111</p>
<p>EDT0:A0000000031010:VSDC:0010000000:D84004F800:D84000A800:000000:500000:99999999</p>
<p>EDT1:A0000000032010:VISA ELECT:0010000000:D84004F800:D84000A800:000000:500000:99999999</p>
<p>EDT2:A0000000033010:VISA INTERLINK:0010000000:D84004F800:D84000A800:000000:500000:99999999</p>
<p>EDT3:A0000000041010:MASTERCARD:0000000000:F45084800C:F45084800C:000000:500000:99999999</p>
<p>EDT4:A0000000043060:MAESTRO:0000000000:F45084800C:F45084800C:000000:500000:99999999</p>
<p>EDT5:A00000033301:UPI:0000000000:D800FC9800:084000A800:000000:500000:99999999</p>
<p>EDT6:A00000091010:TAKAPAY:0000000000:F45084800C:F45084800C:000000:500000:99999999</p>

</div>
<button id="saveButton">create per-file</button>
        <!-- Add more fields as needed -->
</div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.9/xlsx.full.min.js"></script>
    <script>

        document.getElementById('fileInput').addEventListener('change', handleFile, false);

        let excelData = [];

        function handleFile(event) {
            const file = event.target.files[0];
            const reader = new FileReader();

            reader.onload = function (e) {
                const data = new Uint8Array(e.target.result);
                const workbook = XLSX.read(data, { type: 'array' });
                const firstSheetName = workbook.SheetNames[0];
                const worksheet = workbook.Sheets[firstSheetName];
                excelData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });

                displayData(excelData);
            };

            reader.readAsArrayBuffer(file);
        }

        function displayData(data) {
            const table = document.getElementById('dataTable');
            table.innerHTML = ''; // Clear any existing content

            // Create table header
            if (data.length > 0) {
                const headerRow = document.createElement('tr');

                data[0].forEach(header => {
                    const th = document.createElement('th');
                    th.textContent = header;
                    headerRow.appendChild(th);
                });
                const actionTh = document.createElement('th');
                actionTh.textContent = 'Action';
                headerRow.appendChild(actionTh);
                table.appendChild(headerRow);
            }

            // Create table rows
            data.slice(1).forEach((row, rowIndex) => {
                const rowElement = document.createElement('tr');
                row.forEach(cell => {
                    const cellElement = document.createElement('td');
                    cellElement.textContent = cell;
                    rowElement.appendChild(cellElement);
                });

                const actionTd = document.createElement('td');
                const addButton = document.createElement('button');
                addButton.textContent = 'Add';
                addButton.addEventListener('click', () => setData(rowIndex + 1)); // Pass the correct row index
                addButton.onclick = function () {
                    rowElement.style.backgroundColor = "red";
                    saveValueToFile();

                }
                actionTd.appendChild(addButton);
                rowElement.appendChild(actionTd);

                table.appendChild(rowElement);
            });
        }

        function setData(rowIndex) {
            if (rowIndex < 1 || rowIndex >= excelData.length) {
                alert('Invalid data row');
                return;
            }
//testing code strat
    // dba name and address character 28 and dba 21 character split 
    const dba=excelData[rowIndex][2];
    const text=excelData[rowIndex][3];
    
    
     // Function to split text by word into max 28 characters
  function splitMeaningfully(str, maxLen) {
    const words = str.replace(/\t/g, ' ').split(' ');
    const lines = [];
    let currentLine = '';
 
    words.forEach(word => {
      if ((currentLine + ' ' + word).trim().length <= maxLen) {
        currentLine += (currentLine ? ' ' : '') + word;
      } else {
        lines.push(currentLine);
        currentLine = word;
      }
    });

    if (currentLine) lines.push(currentLine);
    return lines;
  }

 // Split into 28-character chunks
 const result = splitMeaningfully(text, 28);
 const dbname = splitMeaningfully(dba, 21);

// Inject into address elements by ID
result.forEach((line, index) => {
  const element = document.getElementById(`add-${index + 1}`);
  if (element) {
    element.textContent = line;
  }
});
// Inject into DBA Name elements by ID
dbname.forEach((line, index) => {
  const element = document.getElementById(`dba-${index + 1}`);
  if (element) {
    element.textContent = line;
  }
});
    
    // testing code end
            // Example: setting the first and second cell of the specified row into HTML elements
            document.getElementById('value1').textContent = excelData[rowIndex][0] || '';
            document.getElementById('value2').textContent = excelData[rowIndex][1] || '';
            document.getElementById('officer').textContent = excelData[rowIndex][4] || '';
            document.getElementById('officernumber').textContent = excelData[rowIndex][5] || '';
            let gp = document.getElementById('gp').textContent = excelData[rowIndex][6] || '';
            let robi = document.getElementById('robi').textContent = excelData[rowIndex][6] || '';
            let bl = document.getElementById('bl').textContent = excelData[rowIndex][6] || '';
            if (gp === 'gp' || gp === 'GP') {
                document.getElementById('gp').textContent = 1;
                

            } else {
                document.getElementById('gp').textContent = 0;

            }
            if (robi === 'robi' || robi === 'RB' || robi === 'ROBI' || robi === 'Robi') {
                document.getElementById('robi').textContent = 1;
              

            } else {
                document.getElementById('robi').textContent = 0;

            }
            if (bl === 'BANGLALINK' || bl === 'banglalink' || robi === 'BL') {
                document.getElementById('bl').textContent = 1;
             
            } else {
                document.getElementById('bl').textContent = 0;

            }
            document.getElementById('hostprot').textContent = excelData[rowIndex][12] || '';

            // Highlight the row by adding background color
            const rowElement = document.getElementById('dataTable').rows[rowIndex]; // Get the row element
            rowElement.style.backgroundColor = 'lightblue'; // Set background color
            // Add more data assignments as needed
        }


        document.getElementById('saveButton').addEventListener('click', saveValueToFile);

        function saveValueToFile() {
            const selectedValue = document.getElementById('selectedValue').textContent;


            if (!selectedValue) {
                alert('No value selected');
                return;
            }

            let indices = [7, 8, 9, 10, 11, 12, 13, 14];
            let substring = indices.map(index => selectedValue.charAt(index + 2)).join('');

            const fileName = substring + '.txt';



            const blob = new Blob([selectedValue], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);

            const a = document.createElement('a');
            a.href = url;
            a.download = fileName;


            document.body.appendChild(a);
            a.click();

            setTimeout(() => {
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }, 0);
        }





    </script>
</body>

</html>